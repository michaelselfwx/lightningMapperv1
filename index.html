<!DOCTYPE html>
<html lang="en">
<head>
  <title>SPC Outlook Mapper</title>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="description" content="" />

  <!-- calls for the arcgis api's CSS file and JS library. -->
  <link rel="stylesheet" href="https://js.arcgis.com/4.25/esri/themes/light/main.css">
  <script src="https://js.arcgis.com/4.25/"></script>

  <!-- Adding the modules, API key, and map constant needed for a full screen map app -->
  <script>
    require([
        "esri/config",
        "esri/Map",
        "esri/views/MapView",
        "esri/layers/GeoJSONLayer"

    ], function (esriConfig, Map, MapView, GeoJSONLayer) {

        esriConfig.apiKey = "AAPKfb3b968ef66d4c848e795b3dd01897e8uTic-7qcXbjlpUVMGReQlWKWAjnWq5pH5r7mLxpcFbX1tfR5Y4bLBPhLOwFOm7NL";

        var date = new Date();
        var year = date.getUTCFullYear();
        var month = ('0' + (date.getUTCMonth() + 1)).slice(-2);
        var day = ('0' + date.getUTCDate()).slice(-2);
        var hour = ('0' + date.getUTCHours()).slice(-2);
        var minute = ('0' + date.getUTCMinutes()).slice(-2);

        var availableHours = [1, 12, 13, 16.5, 20];
        var closestHour = availableHours.reduce(function(prev, curr) {
            return (Math.abs(curr - hour) < Math.abs(prev - hour) ? curr : prev);
        });

        closestHour = ('0' + Math.floor(closestHour)).slice(-2) + ('0' + Math.round((closestHour % 1) * 60)).slice(-2);

        var formattedDateTime = year + month + day + '_' + closestHour;

        var url = "https://michaelself10.tail8c79a.ts.net/https://www.spc.noaa.gov/products/outlook/archive/2024/day1otlk_" + formattedDateTime + "_cat.lyr.geojson";

        var geojsonLayer = new GeoJSONLayer({
            url: url
        });

        var map = new Map({
            basemap: "topo-vector",
            layers: [geojsonLayer]
        });

        var view = new MapView({
            container: "viewDiv", // Reference to the scene div created in step 5
            map: map, // Reference to the map object created before the scene
            zoom: 4, // Sets the zoom level based on level of detail (LOD), this is what I think looks the best
            center: [-81.5158, 27.6648] // Sets the center point of view in lon/lat
        });
    });
  </script>

  <!-- css to make a full screen map -->
  <style>
    html,
    body,
    #viewDiv {
      padding: 0;
      margin: 0;
      height: 100%; 
      width: 100%;
    }
  </style>

</head>
<body>

  <!-- the div to displays the map  -->
  <div id="viewDiv"></div>

</body>
</html>